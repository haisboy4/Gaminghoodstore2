<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gaming Hood - Your Gaming Community</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#FF6B35">
<meta name="description" content="Gaming Hood - Discover, share, and connect with gamers worldwide">
<style>
  /* === CSS VARIABLES === */
  :root {
    --primary: #FF6B35;
    --secondary: #00A8E8;
    --accent: #00E676;
    --dark: #1A1A2E;
    --darker: #0F0F1B;
    --light: #ffffff;
    --gray: #8A8A9D;
    --background: #f4f4f4;
    --surface: #ffffff;
    --text: #333333;
    --text-secondary: #666666;
    --sidebar-width: 280px;
  }

  body.dark {
    --background: var(--dark);
    --surface: #2A2A3E;
    --text: var(--light);
    --text-secondary: var(--gray);
  }

  /* === BASE STYLES === */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Poppins', sans-serif;
    background: var(--background);
    color: var(--text);
    transition: all 0.3s ease;
    overflow-x: hidden;
    padding: 10px;
  }

  /* === SIDEBAR NAVIGATION === */
  .sidebar {
    position: fixed;
    top: 0;
    left: -var(--sidebar-width);
    width: var(--sidebar-width);
    height: 100vh;
    background: linear-gradient(135deg, var(--dark), var(--darker));
    backdrop-filter: blur(20px);
    z-index: 1000;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 20px;
    overflow-y: auto;
    box-shadow: 5px 0 30px rgba(0,0,0,0.3);
  }

  .sidebar.active {
    left: 0;
  }

  .sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(5px);
    z-index: 999;
    display: none;
  }

  .sidebar-overlay.active {
    display: block;
  }

  .sidebar-header {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid rgba(255,255,255,0.1);
  }

  .sidebar-logo {
    font-size: 28px;
    font-weight: bold;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
  }

  .sidebar-tagline {
    color: var(--gray);
    font-size: 14px;
    font-style: italic;
  }

  .sidebar-nav {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    border-radius: 12px;
    color: var(--light);
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
  }

  .nav-item:hover {
    background: rgba(255,255,255,0.1);
    transform: translateX(5px);
  }

  .nav-item.active {
    background: var(--primary);
  }

  .nav-icon {
    font-size: 20px;
    width: 24px;
    text-align: center;
  }

  .nav-text {
    font-weight: 500;
  }

  .sidebar-footer {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 2px solid rgba(255,255,255,0.1);
    text-align: center;
    color: var(--gray);
    font-size: 12px;
  }

  /* === USER PROFILE IN SIDEBAR === */
  .sidebar-user {
    display: none;
    align-items: center;
    gap: 12px;
    padding: 15px;
    background: rgba(255,255,255,0.1);
    border-radius: 12px;
    margin-bottom: 20px;
  }

  .sidebar-user.active {
    display: flex;
  }

  .user-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 18px;
    border: 2px solid var(--primary);
    overflow: hidden;
  }

  .user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
  }

  .user-info {
    flex: 1;
  }

  .user-name {
    font-weight: bold;
    color: white;
    font-size: 16px;
  }

  .user-email {
    color: var(--gray);
    font-size: 12px;
  }

  .logout-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
  }

  .logout-btn:hover {
    background: rgba(255,255,255,0.3);
  }

  /* === HEADER === */
  .header {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 10px;
    background: var(--surface);
    border-radius: 15px;
    margin-bottom: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  }

  .menu-toggle {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--primary);
    padding: 8px;
    border-radius: 10px;
    transition: all 0.3s ease;
  }

  .menu-toggle:hover {
    background: rgba(255,107,53,0.1);
    transform: scale(1.1);
  }

  .logo {
    font-size: 24px;
    font-weight: bold;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    flex: 1;
  }

  .user-menu {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .auth-buttons {
    display: flex;
    gap: 8px;
  }

  .user-profile {
    display: none;
    align-items: center;
    gap: 10px;
  }

  .avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    cursor: pointer;
    border: 2px solid var(--primary);
    overflow: hidden;
  }

  .avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
  }

  /* === ENHANCED LAUNCH SCREEN === */
  #launchScreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--dark), var(--darker));
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 0.5s ease, visibility 0.5s ease;
  }

  .launch-content {
    text-align: center;
    animation: fadeInUp 1s ease;
  }

  .hood-loader {
    width: 80px;
    height: 80px;
    position: relative;
    margin: 0 auto 30px;
  }

  .hood-loader::before,
  .hood-loader::after {
    content: '';
    position: absolute;
    border-radius: 50%;
    animation: hoodPulse 2s linear infinite;
  }

  .hood-loader::before {
    width: 100%;
    height: 100%;
    background: conic-gradient(from 0deg, var(--primary), var(--secondary), var(--accent), var(--primary));
  }

  .hood-loader::after {
    width: 70%;
    height: 70%;
    background: var(--dark);
    top: 15%;
    left: 15%;
    animation: hoodSpin 2s linear infinite;
  }

  @keyframes hoodPulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.8; }
  }

  @keyframes hoodSpin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .launch-title {
    font-size: 2.5em;
    font-weight: bold;
    background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
    animation: glow 2s ease-in-out infinite alternate;
  }

  @keyframes glow {
    from { filter: drop-shadow(0 0 10px var(--primary)); }
    to { filter: drop-shadow(0 0 20px var(--secondary)); }
  }

  .launch-subtitle {
    color: var(--gray);
    font-size: 1.1em;
    margin-bottom: 30px;
    animation: fadeIn 1s ease 0.5s both;
  }

  .loading-dots {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin-top: 20px;
  }

  .dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--primary);
    animation: bounce 1.4s ease-in-out infinite both;
  }

  .dot:nth-child(1) { animation-delay: -0.32s; }
  .dot:nth-child(2) { animation-delay: -0.16s; }

  @keyframes bounce {
    0%, 80%, 100% { transform: scale(0); }
    40% { transform: scale(1); }
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* === PARTICLE BACKGROUND === */
  #particles-js {
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: -1;
    pointer-events: none;
  }

  /* === SEARCH BAR === */
  .search-bar {
    position: sticky; 
    top: 0; 
    z-index: 10;
    background: rgba(255,255,255,0.7);
    backdrop-filter: blur(10px);
    border-radius: 50px;
    display: flex; 
    justify-content: center; 
    align-items: center;
    gap: 6px; 
    padding: 6px 10px; 
    margin-bottom: 8px;
  }
  body.dark .search-bar { 
    background: rgba(42,42,62,0.8); 
  }

  .search-bar input {
    flex: 1; 
    padding: 10px; 
    font-size: 16px;
    border: none; 
    border-radius: 25px; 
    outline: none;
    background: transparent; 
    color: inherit;
  }

  .search-bar button {
    background: var(--primary); 
    border: none; 
    color: white;
    padding: 10px 14px; 
    border-radius: 50%;
    cursor: pointer; 
    font-size: 18px;
    transition: transform 0.2s;
  }

  /* === FILTER BUTTONS === */
  .filter-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 15px 0;
    flex-wrap: wrap;
  }

  .filter-btn, #shuffleBtn, #luckyBtn {
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    color: white; 
    border: none;
    padding: 10px 20px; 
    border-radius: 30px;
    cursor: pointer; 
    font-size: 14px;
    transition: all 0.3s ease;
  }

  .filter-btn.active, #shuffleBtn:hover, #luckyBtn:hover {
    background: linear-gradient(45deg, var(--secondary), var(--accent));
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 168, 232, 0.4);
  }

  /* === GAME GRID & CARDS - FIXED SIZING === */
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 15px;
    margin-top: 10px;
  }

  .flip-card {
    background: transparent;
    perspective: 1000px;
    height: 260px; /* Fixed height */
    border-radius: 15px;
    animation: fadeIn 0.6s ease both;
    position: relative;
    cursor: pointer;
  }

  .flip-card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    text-align: center;
    transition: transform 0.6s;
    transform-style: preserve-3d;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }

  .flip-card.flipped .flip-card-inner {
    transform: rotateY(180deg);
  }

  .flip-card-front, .flip-card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    border-radius: 15px;
    overflow: hidden;
  }

  .flip-card-front {
    background: var(--surface);
    display: flex;
    flex-direction: column;
  }

  .flip-card-back {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    transform: rotateY(180deg);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 15px;
    text-align: center;
  }

  /* === FAVORITE BUTTON === */
  .favorite-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    z-index: 2;
  }

  body.dark .favorite-btn {
    background: rgba(40, 40, 40, 0.9);
  }

  .favorite-btn.active {
    color: var(--secondary);
    animation: heartBeat 0.6s ease;
  }

  @keyframes heartBeat {
    0%, 100% { transform: scale(1); }
    25% { transform: scale(1.3); }
    50% { transform: scale(0.9); }
    75% { transform: scale(1.2); }
  }

  /* === GAME IMAGE - FIXED SIZING === */
  .flip-card-front img { 
    width: 100%; 
    height: 140px; /* Fixed height */
    object-fit: cover; 
    transition: transform 0.3s ease;
  }

  .flip-card:hover .flip-card-front img {
    transform: scale(1.05);
  }

  /* === GAME INFO - FIXED LAYOUT === */
  .flip-card-front .info { 
    padding: 10px; 
    flex: 1; 
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .flip-card-front h3 { 
    font-size: 14px; 
    margin: 0 0 5px; 
    line-height: 1.3;
    font-weight: 600;
    height: 40px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .flip-card-front p { 
    font-size: 12px; 
    color: var(--text-secondary); 
    margin: 0 0 8px; 
  }

  /* === INTERACTIVE RATING SYSTEM === */
  .rating-container {
    margin: 8px 0;
    text-align: center;
  }

  .star-rating {
    display: flex;
    gap: 2px;
    justify-content: center;
    margin-bottom: 5px;
  }

  .star {
    color: #ddd;
    font-size: 14px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .star:hover {
    transform: scale(1.3);
    color: #FFD700;
  }

  .star.active {
    color: #FFD700;
    transform: scale(1.1);
  }

  .rating-text {
    font-size: 11px;
    color: var(--text-secondary);
  }

  /* === GAME STATS === */
  .game-stats {
    display: flex;
    justify-content: space-around;
    margin: 10px 0;
    font-size: 12px;
  }

  .stat {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .stat-value {
    font-weight: bold;
    font-size: 14px;
  }

  .stat-label {
    font-size: 10px;
    opacity: 0.8;
  }

  /* === BUTTONS === */
  .btn {
    display: block; 
    background: rgba(255,255,255,0.2); 
    color: white;
    text-align: center; 
    padding: 8px 12px;
    text-decoration: none; 
    border-radius: 8px;
    transition: all 0.3s ease;
    margin: 5px 0;
    border: 1px solid rgba(255,255,255,0.3);
    backdrop-filter: blur(10px);
  }

  .btn:hover {
    background: rgba(255,255,255,0.3);
    transform: translateY(-2px);
  }

  .btn-primary {
    background: var(--accent);
    border-color: var(--accent);
  }

  .btn-primary:hover {
    background: #00C853;
  }

  /* === MODALS === */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 1000;
    backdrop-filter: blur(5px);
  }

  .modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--surface);
    padding: 25px;
    border-radius: 20px;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
  }

  /* === PROFILE PHOTO UPLOAD === */
  .avatar-upload {
    text-align: center;
    margin: 15px 0;
  }

  .avatar-preview {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    margin: 0 auto 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 24px;
    border: 3px solid var(--primary);
    overflow: hidden;
  }

  .avatar-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
  }

  .upload-btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
  }

  .upload-btn:hover {
    background: var(--secondary);
  }

  /* === SOCIAL FEED STYLES === */
  .social-feed {
    max-width: 600px;
    margin: 0 auto;
    padding: 0 10px;
  }

  .create-post {
    background: var(--surface);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }

  .post-input {
    width: 100%;
    min-height: 100px;
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 12px;
    padding: 15px;
    background: var(--surface);
    color: var(--text);
    resize: vertical;
    margin-bottom: 15px;
    font-family: inherit;
    font-size: 14px;
  }

  .post-input:focus {
    outline: none;
    border-color: var(--primary);
  }

  .post-actions-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
  }

  .game-select {
    flex: 1;
    padding: 10px 12px;
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 8px;
    background: var(--surface);
    color: var(--text);
    font-size: 14px;
  }

  .post-btn {
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
  }

  .post-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255,107,53,0.4);
  }

  .post-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  .post-card {
    background: var(--surface);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    animation: fadeIn 0.5s ease;
  }

  .post-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
  }

  .post-user-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    overflow: hidden;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 16px;
  }

  .post-user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
  }

  .post-user-info {
    flex: 1;
  }

  .post-user-name {
    font-weight: bold;
    font-size: 16px;
    color: var(--text);
  }

  .post-time {
    font-size: 12px;
    color: var(--text-secondary);
  }

  .post-content {
    margin-bottom: 15px;
    line-height: 1.5;
    font-size: 14px;
    white-space: pre-line;
  }

  .post-game {
    background: rgba(255,107,53,0.1);
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 15px;
    border-left: 4px solid var(--primary);
  }

  .post-game-title {
    font-weight: bold;
    font-size: 14px;
    color: var(--primary);
    margin-bottom: 5px;
  }

  .post-game-platform {
    font-size: 12px;
    color: var(--text-secondary);
  }

  .post-actions {
    display: flex;
    gap: 20px;
    border-top: 1px solid rgba(0,0,0,0.1);
    padding-top: 15px;
  }

  .post-action {
    display: flex;
    align-items: center;
    gap: 6px;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 5px 10px;
    border-radius: 8px;
    font-size: 14px;
  }

  .post-action:hover {
    background: rgba(0,0,0,0.05);
    color: var(--primary);
  }

  .post-action.active {
    color: var(--secondary);
  }

  .post-action.liked {
    color: #ff4757;
  }

  .post-action.saved {
    color: var(--accent);
  }

  .comments-section {
    margin-top: 15px;
    border-top: 1px solid rgba(0,0,0,0.1);
    padding-top: 15px;
  }

  .comment-input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 20px;
    background: var(--surface);
    color: var(--text);
    margin-bottom: 10px;
    font-size: 14px;
  }

  .comment-input:focus {
    outline: none;
    border-color: var(--primary);
  }

  .comments-list {
    max-height: 200px;
    overflow-y: auto;
  }

  .comment {
    padding: 10px 0;
    border-bottom: 1px solid rgba(0,0,0,0.05);
  }

  .comment:last-child {
    border-bottom: none;
  }

  .comment-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 5px;
  }

  .comment-user {
    font-weight: bold;
    font-size: 12px;
  }

  .comment-time {
    font-size: 10px;
    color: var(--text-secondary);
  }

  .comment-content {
    font-size: 13px;
    line-height: 1.4;
  }

  .no-posts {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-secondary);
  }

  .no-posts-icon {
    font-size: 48px;
    margin-bottom: 15px;
    opacity: 0.5;
  }

  /* === ENHANCED SOCIAL FEATURES === */
  .post-actions-menu {
    position: relative;
  }
  
  .post-menu-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 5px;
    border-radius: 5px;
    font-size: 18px;
  }
  
  .post-menu {
    position: absolute;
    top: 100%;
    right: 0;
    background: var(--surface);
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    padding: 10px;
    z-index: 100;
    min-width: 120px;
  }
  
  .post-menu button {
    display: block;
    width: 100%;
    background: none;
    border: none;
    padding: 8px 12px;
    text-align: left;
    cursor: pointer;
    border-radius: 5px;
    color: var(--text);
  }
  
  .post-menu button:hover {
    background: rgba(0,0,0,0.05);
  }
  
  .comment-actions {
    margin-left: auto;
    display: flex;
    gap: 5px;
  }
  
  .comment-edit-btn, .comment-delete-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 2px 5px;
    border-radius: 3px;
    font-size: 12px;
  }
  
  .comment-edit-btn:hover {
    background: rgba(255,107,53,0.1);
  }
  
  .comment-delete-btn:hover {
    background: rgba(255,71,87,0.1);
  }
  
  .post-reactions {
    margin-bottom: 15px;
    padding: 10px;
    background: rgba(0,0,0,0.02);
    border-radius: 10px;
  }
  
  .reactions-bar {
    display: flex;
    gap: 5px;
    margin-bottom: 5px;
  }
  
  .reaction-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px 8px;
    border-radius: 20px;
    font-size: 16px;
    transition: all 0.3s ease;
  }
  
  .reaction-btn:hover {
    background: rgba(255,107,53,0.1);
    transform: scale(1.2);
  }
  
  .reaction-btn.active {
    background: rgba(255,107,53,0.2);
    transform: scale(1.1);
  }
  
  .reactions-count {
    font-size: 12px;
    color: var(--text-secondary);
  }

  /* === NOTIFICATION BADGE STYLES === */
  .notification-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff4757;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

  /* === RESPONSIVE DESIGN === */
  @media (max-width: 768px) {
    .sidebar {
      width: 85vw;
      left: -85vw;
    }

    .header {
      padding: 12px 8px;
    }

    .launch-title {
      font-size: 2em;
    }

    .grid {
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    }

    .flip-card {
      height: 240px;
    }

    .flip-card-front img {
      height: 120px;
    }

    .social-feed {
      padding: 0 5px;
    }

    .post-actions-bar {
      flex-direction: column;
      gap: 10px;
    }

    .game-select {
      width: 100%;
    }

    .post-btn {
      width: 100%;
    }
  }

  @media (max-width: 480px) {
    .grid {
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    }

    .flip-card {
      height: 220px;
    }

    .flip-card-front img {
      height: 100px;
    }

    .filter-buttons {
      gap: 5px;
    }

    .filter-btn, #shuffleBtn, #luckyBtn {
      padding: 8px 12px;
      font-size: 12px;
    }

    .post-header {
      gap: 8px;
    }

    .post-user-avatar {
      width: 40px;
      height: 40px;
    }

    .post-actions {
      gap: 10px;
    }

    .post-action {
      padding: 5px 8px;
      font-size: 12px;
    }
  }
</style>
</head>
<body>

<!-- === ENHANCED LAUNCH SCREEN === -->
<div id="launchScreen">
  <div class="launch-content">
    <div class="hood-loader"></div>
    <h1 class="launch-title">Gaming Hood</h1>
    <p class="launch-subtitle">Your Ultimate Gaming Community</p>
    <div class="loading-dots">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  </div>
</div>

<!-- === SIDEBAR NAVIGATION === -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>
<aside class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo">Gaming Hood</div>
    <div class="sidebar-tagline">Your Gaming Community</div>
  </div>
  
  <!-- User Profile in Sidebar -->
  <div class="sidebar-user" id="sidebarUser">
    <div class="user-avatar" id="sidebarUserAvatar">
      <!-- Profile photo will be loaded here -->
    </div>
    <div class="user-info">
      <div class="user-name" id="sidebarUserName">User Name</div>
      <div class="user-email" id="sidebarUserEmail">user@email.com</div>
    </div>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>
  
  <nav class="sidebar-nav">
    <div class="nav-item" onclick="showAuthModal()" id="sidebarLoginItem">
      <span class="nav-icon">👤</span>
      <span class="nav-text">Login / Sign Up</span>
    </div>
    
    <div class="nav-item active" onclick="showSection('games')">
      <span class="nav-icon">🎮</span>
      <span class="nav-text">All Games</span>
    </div>
    
    <div class="nav-item" onclick="showSection('favorites')">
      <span class="nav-icon">❤️</span>
      <span class="nav-text">My Favorites</span>
    </div>
    
    <div class="nav-item" onclick="showSection('collections')">
      <span class="nav-icon">📚</span>
      <span class="nav-text">Collections</span>
    </div>
    
    <div class="nav-item" onclick="showSection('social')">
      <span class="nav-icon">👥</span>
      <span class="nav-text">Social Feed</span>
    </div>
    
    <div class="nav-item" onclick="showSection('top-rated')">
      <span class="nav-icon">⭐</span>
      <span class="nav-text">Top Rated</span>
    </div>
    
    <div class="nav-item" onclick="showSection('achievements')">
      <span class="nav-icon">🏆</span>
      <span class="nav-text">Achievements</span>
    </div>
    
    <div class="nav-item" onclick="toggleTheme()">
      <span class="nav-icon" id="themeIcon">🌞</span>
      <span class="nav-text" id="themeText">Light Mode</span>
    </div>
  </nav>
  
  <div class="sidebar-footer">
    <p>Gaming Hood v4.0</p>
    <p>Built with ❤️ for gamers</p>
  </div>
</aside>

<!-- === PARTICLE BACKGROUND === -->
<div id="particles-js"></div>

<!-- === MAIN HEADER === -->
<div class="header">
  <button class="menu-toggle" onclick="toggleSidebar()">☰</button>
  <div class="logo">Gaming Hood</div>
  <div class="user-menu">
    <div class="auth-buttons" id="authButtons">
      <button onclick="showAuthModal()" style="background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer;">Login</button>
    </div>
    <div class="user-profile" id="userProfile">
      <div class="avatar" id="userAvatar">
        <!-- Profile photo will be loaded here -->
      </div>
    </div>
  </div>
</div>

<!-- === SEARCH BAR === -->
<div class="search-bar">
  <input type="text" id="searchInput" placeholder="Search games in the Hood...">
  <button id="searchBtn">🔍</button>
</div>

<!-- === MAIN CONTENT === -->
<div class="container">
  <!-- Games Section -->
  <div id="gamesSection">
    <div class="filter-buttons">
      <button class="filter-btn active" onclick="filterGames('all')">All Games</button>
      <button class="filter-btn" onclick="filterGames('favorites')">❤️ Favorites</button>
      <button class="filter-btn" onclick="filterGames('top-rated')">⭐ Top Rated</button>
      <button id="shuffleBtn" onclick="shuffleGames()">🎲 Shuffle</button>
      <button id="luckyBtn" onclick="feelingLucky()">🎯 Feeling Lucky</button>
    </div>
    
    <div id="grid" class="grid">
      <!-- Games will be loaded here -->
    </div>
  </div>

  <!-- Social Feed Section -->
  <div id="socialSection" style="display: none;">
    <div class="social-feed">
      <div class="create-post">
        <textarea class="post-input" id="postContent" placeholder="Share your gaming experience, tips, or ask for help..."></textarea>
        <div class="post-actions-bar">
          <select class="game-select" id="postGameSelect">
            <option value="">Select a game to tag (optional)...</option>
          </select>
          <button class="post-btn" onclick="createPost()" id="postBtn">Post to Feed</button>
        </div>
      </div>
      <div id="postsContainer">
        <!-- Posts will be loaded here -->
      </div>
    </div>
  </div>

  <!-- Favorites Section -->
  <div id="favoritesSection" style="display: none;">
    <h2 style="margin-bottom: 20px;">My Favorite Games</h2>
    <div id="favoritesGrid" class="grid">
      <!-- Favorite games will be loaded here -->
    </div>
  </div>

  <!-- Collections Section -->
  <div id="collectionsSection" style="display: none;">
    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
      <h2>My Collections</h2>
      <button onclick="showCreateCollectionModal()" style="background: var(--primary); color: white; border: none; padding: 10px 15px; border-radius: 20px; cursor: pointer;">+ New Collection</button>
    </div>
    <div id="collectionsGrid" class="collections-grid">
      <!-- Collections will be loaded here -->
    </div>
  </div>

  <!-- Top Rated Section -->
  <div id="topRatedSection" style="display: none;">
    <h2 style="margin-bottom: 20px;">Top Rated Games</h2>
    <div id="topRatedGrid" class="grid">
      <!-- Top rated games will be loaded here -->
    </div>
  </div>

  <!-- Achievements Section -->
  <div id="achievementsSection" style="display: none;">
    <h2 style="margin-bottom: 20px;">My Achievements</h2>
    <div id="achievementsGrid" class="grid">
      <!-- Achievements will be loaded here -->
    </div>
  </div>
</div>

<!-- === AUTH MODAL === -->
<div id="authModal" class="modal">
  <div class="modal-content">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h3>Join the Gaming Hood</h3>
      <button onclick="closeModal('authModal')" style="background: none; border: none; font-size: 24px; cursor: pointer;">×</button>
    </div>
    <div id="authForms">
      <div id="loginForm">
        <input type="text" id="loginEmail" placeholder="Email" style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ccc; background: var(--surface); color: var(--text);">
        <input type="password" id="loginPassword" placeholder="Password" style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ccc; background: var(--surface); color: var(--text);">
        <button onclick="login()" style="width: 100%; padding: 12px; background: linear-gradient(45deg, var(--primary), var(--secondary)); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">Enter the Hood</button>
        <p style="text-align: center; margin: 15px 0; color: var(--text-secondary);">New here? <a href="#" onclick="showRegister()" style="color: var(--primary);">Join the Community</a></p>
      </div>
      <div id="registerForm" style="display: none;">
        <!-- Profile Photo Upload in Registration -->
        <div class="avatar-upload">
          <div class="avatar-preview" id="avatarPreview" onclick="document.getElementById('avatarInput').click()">
            <span>+</span>
          </div>
          <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="previewAvatar(event)">
          <button class="upload-btn" onclick="document.getElementById('avatarInput').click()">Upload Photo</button>
        </div>
        
        <input type="text" id="registerName" placeholder="Gamer Tag" style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ccc; background: var(--surface); color: var(--text);">
        <input type="email" id="registerEmail" placeholder="Email" style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ccc; background: var(--surface); color: var(--text);">
        <input type="password" id="registerPassword" placeholder="Password" style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ccc; background: var(--surface); color: var(--text);">
        <button onclick="register()" style="width: 100%; padding: 12px; background: linear-gradient(45deg, var(--secondary), var(--accent)); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">Join Gaming Hood</button>
        <p style="text-align: center; margin: 15px 0; color: var(--text-secondary);">Already part of the Hood? <a href="#" onclick="showLogin()" style="color: var(--primary);">Sign In</a></p>
      </div>
    </div>
  </div>
</div>

<!-- === CREATE COLLECTION MODAL === -->
<div id="createCollectionModal" class="modal">
  <div class="modal-content">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h3>Create New Collection</h3>
      <button onclick="closeModal('createCollectionModal')" style="background: none; border: none; font-size: 24px; cursor: pointer;">×</button>
    </div>
    <input type="text" id="collectionName" placeholder="Collection Name" style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ccc; background: var(--surface); color: var(--text);">
    <button onclick="createCollection()" style="width: 100%; padding: 12px; background: linear-gradient(45deg, var(--primary), var(--secondary)); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">Create Collection</button>
  </div>
</div>

<!-- === SOUND ELEMENTS === -->
<audio id="flipSound" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg"></audio>
<audio id="favoriteSound" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3" type="audio/mpeg"></audio>
<audio id="achievementSound" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg"></audio>
<audio id="postSound" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg"></audio>

<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
// === GAMING HOOD - COMPLETE WITH ALL FEATURES ===

// Initialize particles
particlesJS('particles-js', {
  particles: {
    number: { value: 50, density: { enable: true, value_area: 800 } },
    color: { value: "#FF6B35" },
    shape: { type: "circle" },
    opacity: { value: 0.5, random: true },
    size: { value: 3, random: true },
    line_linked: {
      enable: true,
      distance: 150,
      color: "#FF6B35",
      opacity: 0.2,
      width: 1
    },
    move: {
      enable: true,
      speed: 2,
      direction: "none",
      random: true,
      straight: false,
      out_mode: "out",
      bounce: false
    }
  }
});

// === DATA STORAGE ===
const sheetUrl = "https://docs.google.com/spreadsheets/d/1USDHhOVNWZQczP9uhHLv7Vscr3wP-qzGemkggbQLU9I/export?format=csv";
let allGames = [];
let favorites = JSON.parse(localStorage.getItem('gameFavorites')) || [];
let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
let gameRatings = JSON.parse(localStorage.getItem('gameRatings')) || {};
let userDatabase = JSON.parse(localStorage.getItem('userDatabase')) || {};
let collections = JSON.parse(localStorage.getItem('collections')) || {};
let achievements = JSON.parse(localStorage.getItem('achievements')) || {};
let socialPosts = JSON.parse(localStorage.getItem('socialPosts')) || [];
let avatarFile = null;

// === NOTIFICATION SYSTEM ===
let notifications = JSON.parse(localStorage.getItem('notifications')) || [];
let unreadNotifications = JSON.parse(localStorage.getItem('unreadNotifications')) || 0;

// === ADMIN CONTROLS ===
const ADMIN_EMAIL = 'haisboy4@gmail.com';

function isAdmin() {
  return currentUser && currentUser.email === ADMIN_EMAIL;
}

// === AUTO-LOADING SYSTEM ===
let isLoading = true;

async function initializeApp() {
  try {
    await loadGamesFromCSV();
  } catch (error) {
    console.error('Failed to load games:', error);
    loadFallbackGames();
  } finally {
    // AUTO DISPLAY GAMES IMMEDIATELY AFTER LOADING
    displayGames(allGames);
    
    // Initialize game select for posts
    updateGameSelect();
    
    setTimeout(() => {
      isLoading = false;
      const launchScreen = document.getElementById('launchScreen');
      launchScreen.style.opacity = '0';
      setTimeout(() => {
        launchScreen.style.visibility = 'hidden';
      }, 500);
    }, 2000);
  }
  
  // Initialize user interface
  updateUserInterface();
  
  // Update notification badge
  updateNotificationBadge();
}

// === CSV LOADING ===
async function loadGamesFromCSV() {
  try {
    const response = await fetch(sheetUrl);
    if (!response.ok) throw new Error('Network response was not ok');
    
    const csv = await response.text();
    const rows = csv.trim().split("\n").slice(1);
    
    allGames = rows.map(row => {
      const [name, Platform, image, link] = row.split(",").map(field => field.trim());
      const gameId = name.toLowerCase().replace(/[^a-z0-9]/g, '-');
      
      // Initialize ratings for each game
      if (!gameRatings[gameId]) {
        gameRatings[gameId] = 0;
        gameRatings[gameId + '_count'] = 0;
        gameRatings[gameId + '_total'] = 0;
        gameRatings[gameId + '_users'] = {};
      }
      
      return { 
        name: name || 'Unknown Game',
        Platform: Platform || 'UNKNOWN',
        image: image || 'https://via.placeholder.com/160x140/666/white?text=🎮',
        link: link || '#',
        id: gameId,
        rating: gameRatings[gameId] || 0,
        ratingCount: gameRatings[gameId + '_count'] || 0
      };
    });
    
    localStorage.setItem('gameRatings', JSON.stringify(gameRatings));
    
  } catch (error) {
    console.error('Error loading CSV:', error);
    throw error;
  }
}

function loadFallbackGames() {
  allGames = [
    {
      id: 'fts-26',
      name: 'FTS 26',
      Platform: 'ANDROID',
      image: 'https://i.postimg.cc/K8fJqv9X/IMG-20251008-162914-842.jpg',
      link: 'https://www.mediafire.com/file/ultgiieo40to3a4/FTS+26+EUROPEU.7z/file',
      rating: 4.5,
      ratingCount: 1
    },
    {
      id: 'gta-san-andreas', 
      name: 'GTA SAN ANDREAS',
      Platform: 'ANDROID',
      image: 'https://i.postimg.cc/hGgCCC7B/IMG-20251008-133553-928.jpg',
      link: 'https://www.mediafire.com/file/olmlnq9gmnlu95t/Grand_Theft_Auto_San_Andreas_v2.11.277_luzgamer.com.apk/file',
      rating: 4.8,
      ratingCount: 1
    }
  ];
}

// === GAME DISPLAY ===
function displayGames(games) {
  const grid = document.getElementById('grid');
  if (!grid) {
    console.log('Grid element not found!');
    return;
  }
  
  console.log('Displaying games:', games.length);
  
  grid.innerHTML = games.map(game => createGameCard(game, favorites.includes(game.id))).join('');
}

// === FIXED TOP-RATED SECTION ===
function showSection(section) {
  // Hide all sections
  document.querySelectorAll('[id$="Section"]').forEach(section => {
    section.style.display = 'none';
  });
  
  // Update navigation
  document.querySelectorAll('.nav-item').forEach(item => {
    item.classList.remove('active');
  });
  event.currentTarget.classList.add('active');
  
  if (window.innerWidth <= 768) {
    closeSidebar();
  }
  
  // Show selected section
  switch(section) {
    case 'games':
      document.getElementById('gamesSection').style.display = 'block';
      displayGames(allGames);
      break;
    case 'favorites':
      document.getElementById('favoritesSection').style.display = 'block';
      const favoriteGames = allGames.filter(game => favorites.includes(game.id));
      if (favoriteGames.length > 0) {
        document.getElementById('favoritesGrid').innerHTML = favoriteGames.map(game => createGameCard(game, true)).join('');
      } else {
        document.getElementById('favoritesGrid').innerHTML = `
          <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-secondary);">
            <div style="font-size: 48px; margin-bottom: 15px;">❤️</div>
            <h3>No Favorite Games Yet</h3>
            <p>Start adding games to your favorites by clicking the heart icon!</p>
          </div>
        `;
      }
      break;
    case 'collections':
      document.getElementById('collectionsSection').style.display = 'block';
      if (currentUser) {
        displayCollections();
      } else {
        document.getElementById('collectionsGrid').innerHTML = '<p>Please login to view collections!</p>';
      }
      break;
    case 'social':
      document.getElementById('socialSection').style.display = 'block';
      displaySocialFeed();
      // Clear notifications when viewing feed
      clearSocialNotifications();
      break;
    case 'top-rated':
      document.getElementById('topRatedSection').style.display = 'block';
      const topRatedGames = allGames.filter(game => game.rating >= 3.5)
                           .sort((a, b) => b.rating - a.rating)
                           .slice(0, 20); // Show top 20 rated games
      if (topRatedGames.length > 0) {
        document.getElementById('topRatedGrid').innerHTML = topRatedGames.map(game => createGameCard(game, favorites.includes(game.id))).join('');
      } else {
        document.getElementById('topRatedGrid').innerHTML = `
          <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-secondary);">
            <div style="font-size: 48px; margin-bottom: 15px;">⭐</div>
            <h3>No Top Rated Games Yet</h3>
            <p>Games will appear here as users rate them!</p>
          </div>
        `;
      }
      break;
    case 'achievements':
      document.getElementById('achievementsSection').style.display = 'block';
      showAchievementsSection();
      break;
  }
}

// Helper function to create game cards
function createGameCard(game, isFavorite = false) {
  const userRating = currentUser ? (gameRatings[game.id + '_users']?.[currentUser.id] || 0) : 0;
  const averageRating = game.rating;
  
  return `
    <div class="flip-card" onclick="flipCard(this)">
      <div class="flip-card-inner">
        <div class="flip-card-front">
          <button class="favorite-btn ${isFavorite ? 'active' : ''}" 
                  onclick="event.stopPropagation(); toggleFavorite('${game.id}')">
            ${isFavorite ? '❤️' : '🤍'}
          </button>
          <img src="${game.image}" alt="${game.name}" 
               onerror="this.src='https://via.placeholder.com/160x140/666/white?text=🎮'">
          <div class="info">
            <h3>${game.name}</h3>
            <p>${game.Platform}</p>
            <div class="rating-container">
              <div class="star-rating">
                ${[1,2,3,4,5].map(star => 
                  `<span class="star ${star <= userRating ? 'active' : ''} ${star <= Math.round(averageRating) ? 'community-rated' : ''}" 
                        onclick="event.stopPropagation(); rateGame('${game.id}', ${star})">⭐</span>`
                ).join('')}
              </div>
              <div class="rating-text">
                ${averageRating > 0 ? `⭐ ${averageRating.toFixed(1)}/5 (${game.ratingCount})` : 'Not rated yet'}
                ${userRating > 0 ? `<br><small>Your: ${userRating}/5</small>` : ''}
              </div>
            </div>
          </div>
        </div>
        <div class="flip-card-back">
          <h3>${game.name}</h3>
          <p>${game.Platform}</p>
          
          <div class="game-stats">
            <div class="stat">
              <div class="stat-value">${averageRating > 0 ? averageRating.toFixed(1) : '-'}</div>
              <div class="stat-label">Rating</div>
            </div>
            <div class="stat">
              <div class="stat-value">${game.ratingCount}</div>
              <div class="stat-label">Votes</div>
            </div>
            <div class="stat">
              <div class="stat-value">${isFavorite ? '❤️' : '🤍'}</div>
              <div class="stat-label">Favorite</div>
            </div>
          </div>

          <a class="btn btn-primary" href="${game.link}" target="_blank" onclick="event.stopPropagation()">
            🎮 Download Now
          </a>
          
          ${currentUser ? `
            <div class="btn" onclick="event.stopPropagation(); showAddToCollection('${game.id}')">
              📚 Add to Collection
            </div>
            
            <div class="rating-container">
              <small>Rate this game:</small>
              <div class="star-rating">
                ${[1,2,3,4,5].map(star => 
                  `<span class="star ${star <= userRating ? 'active' : ''}" 
                        onclick="event.stopPropagation(); rateGame('${game.id}', ${star})">⭐</span>`
                ).join('')}
              </div>
            </div>
          ` : ''}
        </div>
      </div>
    </div>
  `;
}

// === ENHANCED SOCIAL FEED WITH ADMIN CONTROLS ===
function displaySocialFeed() {
  const postsContainer = document.getElementById('postsContainer');
  
  if (socialPosts.length === 0) {
    postsContainer.innerHTML = `
      <div class="no-posts">
        <div class="no-posts-icon">💬</div>
        <h3>No posts yet</h3>
        <p>Be the first to share your gaming experience with the community!</p>
        ${currentUser ? `
          <button onclick="createSamplePost()" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; margin-top: 15px;">
            🎮 Create Sample Post
          </button>
        ` : ''}
      </div>
    `;
    return;
  }
  
  postsContainer.innerHTML = socialPosts.map(post => {
    const game = post.gameId ? allGames.find(g => g.id === post.gameId) : null;
    const timeAgo = getTimeAgo(post.timestamp);
    const isLiked = post.likes.includes(currentUser?.id);
    const likeCount = post.likes.length;
    const commentCount = post.comments.length;
    const isOwnPost = currentUser && post.userId === currentUser.id;
    const isAdminUser = isAdmin();
    
    const reactions = post.reactions || {};
    const userReaction = reactions[currentUser?.id];
    
    return `
      <div class="post-card" data-post-id="${post.id}">
        <div class="post-header">
          <div class="post-user-avatar" style="background: ${post.userAvatarColor};">
            ${post.userAvatar ? `<img src="${post.userAvatar}" alt="${post.userName}" class="responsive-avatar">` : post.userName[0].toUpperCase()}
          </div>
          <div class="post-user-info">
            <div class="post-user-name">
              ${post.userName} 
              ${isOwnPost ? '<small style="color: var(--primary);">(You)</small>' : ''}
              ${isAdminUser && !isOwnPost ? '<small style="color: #ff4757; margin-left: 5px;">👑</small>' : ''}
            </div>
            <div class="post-time">${timeAgo}</div>
          </div>
          ${(isOwnPost || isAdminUser) ? `
            <div class="post-actions-menu">
              <button class="post-menu-btn" onclick="showPostMenu('${post.id}')">⋯</button>
              <div class="post-menu" id="post-menu-${post.id}" style="display: none;">
                ${isOwnPost ? `<button onclick="editPost('${post.id}')">✏️ Edit</button>` : ''}
                <button onclick="deletePost('${post.id}')" style="color: #ff4757;">
                  ${isAdminUser && !isOwnPost ? '👑 Delete as Admin' : '🗑️ Delete'}
                </button>
                ${isAdminUser && !isOwnPost ? `<button onclick="banUser('${post.userId}')" style="color: #ff4757;">🚫 Ban User</button>` : ''}
              </div>
            </div>
          ` : ''}
        </div>
        
        <div class="post-content" id="post-content-${post.id}">${post.content}</div>
        
        ${game ? `
          <div class="post-game">
            <div class="post-game-title">🎮 ${game.name}</div>
            <div class="post-game-platform">${game.Platform}</div>
          </div>
        ` : ''}
        
        <div class="post-reactions">
          <div class="reactions-bar">
            <button class="reaction-btn ${userReaction === 'fire' ? 'active' : ''}" onclick="addReaction('${post.id}', 'fire')">🔥</button>
            <button class="reaction-btn ${userReaction === 'laugh' ? 'active' : ''}" onclick="addReaction('${post.id}', 'laugh')">😂</button>
            <button class="reaction-btn ${userReaction === 'mindblown' ? 'active' : ''}" onclick="addReaction('${post.id}', 'mindblown')">🤯</button>
            <button class="reaction-btn ${userReaction === 'clap' ? 'active' : ''}" onclick="addReaction('${post.id}', 'clap')">👏</button>
          </div>
          <div class="reactions-count">
            ${Object.keys(reactions).length > 0 ? `
              ${Object.entries(reactions).slice(0, 3).map(([_, reaction]) => {
                const reactionIcons = { fire: '🔥', laugh: '😂', mindblown: '🤯', clap: '👏' };
                return reactionIcons[reaction];
              }).join('')}
              ${Object.keys(reactions).length > 3 ? `+${Object.keys(reactions).length - 3}` : ''}
            ` : ''}
          </div>
        </div>
        
        <div class="post-actions">
          <button class="post-action ${isLiked ? 'liked' : ''}" onclick="toggleLike('${post.id}')">
            ${isLiked ? '❤️' : '🤍'} ${likeCount || ''}
          </button>
          <button class="post-action" onclick="toggleComments('${post.id}')">
            💬 ${commentCount || ''}
          </button>
          <button class="post-action" onclick="sharePost('${post.id}')">
            🔗 Share
          </button>
          <button class="post-action ${post.savedBy?.includes(currentUser?.id) ? 'saved' : ''}" onclick="toggleSavePost('${post.id}')">
            ${post.savedBy?.includes(currentUser?.id) ? '⭐' : '✰'} Save
          </button>
        </div>
        
        <div class="comments-section" id="comments-${post.id}" style="display: none;">
          <div class="comments-list" id="comments-list-${post.id}">
            ${post.comments.map(comment => {
              const isOwnComment = currentUser && comment.userId === currentUser.id;
              const isAdminUser = isAdmin();
              return `
                <div class="comment" id="comment-${comment.id}">
                  <div class="comment-header">
                    <span class="comment-user">
                      ${comment.userName} 
                      ${isOwnComment ? '<small style="color: var(--primary);">(You)</small>' : ''}
                      ${isAdminUser && !isOwnComment ? '<small style="color: #ff4757; margin-left: 5px;">👑</small>' : ''}
                    </span>
                    <span class="comment-time">${getTimeAgo(comment.timestamp)}</span>
                    ${(isOwnComment || isAdminUser) ? `
                      <div class="comment-actions">
                        ${isOwnComment ? `<button class="comment-edit-btn" onclick="editComment('${post.id}', '${comment.id}')">✏️</button>` : ''}
                        <button class="comment-delete-btn" onclick="deleteComment('${post.id}', '${comment.id}', ${isAdminUser && !isOwnComment})">
                          ${isAdminUser && !isOwnComment ? '👑' : '🗑️'}
                        </button>
                      </div>
                    ` : ''}
                  </div>
                  <div class="comment-content" id="comment-content-${comment.id}">${comment.content}</div>
                </div>
              `;
            }).join('')}
          </div>
          ${currentUser ? `
            <div style="display: flex; gap: 10px; margin-top: 10px;">
              <input type="text" class="comment-input" id="comment-input-${post.id}" placeholder="Write a comment..." onkeypress="if(event.key === 'Enter') addComment('${post.id}')">
              <button onclick="addComment('${post.id}')" style="background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 15px; cursor: pointer;">Post</button>
            </div>
          ` : ''}
        </div>
      </div>
    `;
  }).join('');
}

// === SOCIAL FEED FUNCTIONALITY ===
function updateGameSelect() {
  const gameSelect = document.getElementById('postGameSelect');
  gameSelect.innerHTML = '<option value="">Select a game to tag (optional)...</option>' +
    allGames.map(game => `<option value="${game.id}">${game.name}</option>`).join('');
}

function createPost() {
  if (!currentUser) {
    showAuthModal();
    return;
  }
  
  const content = document.getElementById('postContent').value.trim();
  const gameId = document.getElementById('postGameSelect').value;
  
  if (!content) {
    alert('Please write something in your post!');
    return;
  }
  
  const post = {
    id: 'post_' + Date.now(),
    userId: currentUser.id,
    userName: currentUser.name,
    userAvatar: currentUser.avatarUrl || null,
    userAvatarColor: getAvatarUrl(currentUser),
    content: content,
    gameId: gameId,
    timestamp: new Date().toISOString(),
    likes: [],
    comments: [],
    reactions: {},
    savedBy: []
  };
  
  socialPosts.unshift(post);
  localStorage.setItem('socialPosts', JSON.stringify(socialPosts));
  
  // Clear form
  document.getElementById('postContent').value = '';
  document.getElementById('postGameSelect').value = '';
  
  // Refresh feed
  displaySocialFeed();
  playSound('postSound');
  unlockAchievement('socializer', 'Community Socializer!', 'You created your first post!');
}

function toggleLike(postId) {
  if (!currentUser) {
    showAuthModal();
    return;
  }
  
  const post = socialPosts.find(p => p.id === postId);
  if (!post) return;
  
  const userIndex = post.likes.indexOf(currentUser.id);
  const wasLiked = userIndex > -1;
  
  if (wasLiked) {
    post.likes.splice(userIndex, 1);
  } else {
    post.likes.push(currentUser.id);
    playSound('favoriteSound');
    
    // Notify post owner if it's not their own post
    if (post.userId !== currentUser.id) {
      addNotification('like', `${currentUser.name} liked your post`, '❤️');
    }
  }
  
  localStorage.setItem('socialPosts', JSON.stringify(socialPosts));
  displaySocialFeed();
}

function toggleComments(postId) {
  const commentsSection = document.getElementById(`comments-${postId}`);
  if (commentsSection.style.display === 'none') {
    commentsSection.style.display = 'block';
  } else {
    commentsSection.style.display = 'none';
  }
}

function addComment(postId) {
  if (!currentUser) {
    showAuthModal();
    return;
  }
  
  const commentInput = document.getElementById(`comment-input-${postId}`);
  const content = commentInput.value.trim();
  
  if (!content) return;
  
  const post = socialPosts.find(p => p.id === postId);
  if (!post) return;
  
  const comment = {
    id: 'comment_' + Date.now(),
    userId: currentUser.id,
    userName: currentUser.name,
    content: content,
    timestamp: new Date().toISOString()
  };
  
  post.comments.push(comment);
  localStorage.setItem('socialPosts', JSON.stringify(socialPosts));
  
  // Clear input and refresh
  commentInput.value = '';
  displaySocialFeed();
  
  // Keep comments section open
  document.getElementById(`comments-${postId}`).style.display = 'block';
  
  // Notify post owner if it's not their own post
  if (post.userId !== currentUser.id) {
    addNotification('comment', `${currentUser.name} commented on your post`, '💬');
  }
}

function sharePost(postId) {
  const post = socialPosts.find(p => p.id === postId);
  if (!post) return;
  
  const game = post.gameId ? allGames.find(g => g.id === post.gameId) : null;
  const shareText = `Check out this post from ${post.userName} in Gaming Hood!`;
  
  if (navigator.share) {
    navigator.share({
      title: 'Gaming Hood Post',
      text: shareText,
      url: window.location.href
    });
  } else {
    // Fallback: copy to clipboard
    const tempInput = document.createElement('input');
    tempInput.value = `${shareText}\n\n"${post.content}"\n\n${window.location.href}`;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);
    
    alert('Post content copied to clipboard!');
  }
}

// 🎉 SURPRISE FEATURE: Post Reactions
function addReaction(postId, reaction) {
  if (!currentUser) {
    showAuthModal();
    return;
  }
  
  const post = socialPosts.find(p => p.id === postId);
  if (!post) return;
  
  if (!post.reactions) {
    post.reactions = {};
  }
  
  // Toggle reaction - if same reaction, remove it
  if (post.reactions[currentUser.id] === reaction) {
    delete post.reactions[currentUser.id];
  } else {
    post.reactions[currentUser.id] = reaction;
  }
  
  localStorage.setItem('socialPosts', JSON.stringify(socialPosts));
  displaySocialFeed();
  playSound('favoriteSound');
}

// 🎉 SURPRISE FEATURE: Save Posts
function toggleSavePost(postId) {
  if (!currentUser) {
    showAuthModal();
    return;
  }
  
  const post = socialPosts.find(p => p.id === postId);
  if (!post) return;
  
  if (!post.savedBy) {
    post.savedBy = [];
  }
  
  const userIndex = post.savedBy.indexOf(currentUser.id);
  if (userIndex > -1) {
    post.savedBy.splice(userIndex, 1);
  } else {
    post.savedBy.push(currentUser.id);
    unlockAchievement('bookmarker', 'Post Bookmarker!', 'You saved your first post!');
  }
  
  localStorage.setItem('socialPosts', JSON.stringify(socialPosts));
  displaySocialFeed();
  playSound('favoriteSound');
}

// 🎉 SURPRISE FEATURE: Sample Post Creator
function createSamplePost() {
  if (!currentUser) return;
  
  const samplePosts = [
    "Just discovered an amazing hidden gem in my game collection! The storyline is incredible! 🎮✨",
    "Anyone else stuck on the final boss? Need some tips and tricks! 💪",
    "Just achieved 100% completion! This game is a masterpiece! 🏆",
    "The graphics in this game are absolutely stunning! Can't stop taking screenshots! 📸",
    "Multiplayer with friends tonight was absolutely hilarious! 😂 Best gaming session ever!"
  ];
  
  const sampleGames = allGames.filter(game => game.rating >= 4);
  const randomPost = samplePosts[Math.floor(Math.random() * samplePosts.length)];
  const randomGame = sampleGames.length > 0 ? sampleGames[Math.floor(Math.random() * sampleGames.length)] : null;
  
  const post = {
    id: 'post_' + Date.now(),
    userId: currentUser.id,
    userName: currentUser.name,
    userAvatar: currentUser.avatarUrl || null,
    userAvatarColor: getAvatarUrl(currentUser),
    content: randomPost,
    gameId: randomGame ? randomGame.id : null,
    timestamp: new Date().toISOString(),
    likes: [],
    comments: [],
    reactions: {},
    savedBy: []
  };
  
  socialPosts.unshift(post);
  localStorage.setItem('socialPosts', JSON.stringify(socialPosts));
  displaySocialFeed();
  playSound('postSound');
  
  unlockAchievement('first_post', 'First Post!', 'You created your first post!');
}

// === COMMENT EDITING & DELETION ===
function editComment(postId, commentId) {
  const comment = socialPosts.find(p => p.id === postId)?.comments.find(c => c.id === commentId);
  if (!comment) return;
  
  const commentElement = document.getElementById(`comment-content-${commentId}`);
  const currentContent = commentElement.textContent;
  
  const newContent = prompt('Edit your comment:', currentContent);
  if (newContent !== null && newContent.trim() !== '' && newContent !== currentContent) {
    comment.content = newContent.trim();
    comment.edited = true;
    localStorage.setItem('socialPosts', JSON.stringify(socialPosts));
    displaySocialFeed();
    
    // Keep comments section open
    document.getElementById(`comments-${postId}`).style.display = 'block';
  }
}

function deleteComment(postId, commentId, isAdminDelete = false) {
  if (!currentUser && !isAdminDelete) return;
  
  const post = socialPosts.find(p => p.id === postId);
  if (!post) return;
  
  const comment = post.comments.find(c => c.id === commentId);
  if (!comment) return;
  
  const isOwnComment = currentUser && comment.userId === currentUser.id;
  
  if (!isOwnComment && !isAdminDelete) {
    alert('You can only delete your own comments.');
    return;
  }
  
  const confirmMessage = isAdminDelete 
    ? `Delete comment by "${comment.userName}" as admin?`
    : 'Are you sure you want to delete this comment?';
  
  if (confirm(confirmMessage)) {
    post.comments = post.comments.filter(c => c.id !== commentId);
    localStorage.setItem('socialPosts', JSON.stringify(socialPosts));
    displaySocialFeed();
    
    // Keep comments section open
    document.getElementById(`comments-${postId}`).style.display = 'block';
    
    // Add notification for admin actions
    if (isAdminDelete) {
      addNotification('admin_action', `Removed comment by ${comment.userName}`, '👑');
    }
  }
}

// === POST EDITING & DELETION ===
function showPostMenu(postId) {
  // Hide all other menus first
  document.querySelectorAll('.post-menu').forEach(menu => {
    menu.style.display = 'none';
  });
  
  const menu = document.getElementById(`post-menu-${postId}`);
  menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
}

function editPost(postId) {
  const post = socialPosts.find(p => p.id === postId);
  if (!post) return;
  
  const newContent = prompt('Edit your post:', post.content);
  if (newContent !== null && newContent.trim() !== '' && newContent !== post.content) {
    post.content = newContent.trim();
    post.edited = true;
    localStorage.setItem('socialPosts', JSON.stringify(socialPosts));
    displaySocialFeed();
  }
  
  // Hide menu
  document.getElementById(`post-menu-${postId}`).style.display = 'none';
}

function deletePost(postId) {
  if (!confirm('Are you sure you want to delete this post?')) return;
  
  socialPosts = socialPosts.filter(p => p.id !== postId);
  localStorage.setItem('socialPosts', JSON.stringify(socialPosts));
  displaySocialFeed();
}

// Close post menus when clicking elsewhere
document.addEventListener('click', function(e) {
  if (!e.target.closest('.post-actions-menu')) {
    document.querySelectorAll('.post-menu').forEach(menu => {
      menu.style.display = 'none';
    });
  }
});

function getTimeAgo(timestamp) {
  const now = new Date();
  const postTime = new Date(timestamp);
  const diff = now - postTime;
  
  const seconds = Math.floor(diff / 1000);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);
  const days = Math.floor(hours / 24);
  
  if (seconds < 60) return 'Just now';
  if (minutes < 60) return `${minutes}m ago`;
  if (hours < 24) return `${hours}h ago`;
  if (days < 7) return `${days}d ago`;
  
  return postTime.toLocaleDateString();
}

// === ADMIN FUNCTIONS ===
function banUser(userId) {
  if (!isAdmin()) return;
  
  const userToBan = Object.values(userDatabase).find(user => user.id === userId);
  if (!userToBan) return;
  
  if (confirm(`Are you sure you want to ban user "${userToBan.name}" (${userToBan.email})? This will delete all their posts and comments.`)) {
    // Remove user's posts
    socialPosts = socialPosts.filter(post => post.userId !== userId);
    
    // Remove user's comments from all posts
    socialPosts.forEach(post => {
      post.comments = post.comments.filter(comment => comment.userId !== userId);
    });
    
    // Remove user from database
    delete userDatabase[userToBan.email];
    
    // Save changes
    localStorage.setItem('socialPosts', JSON.stringify(socialPosts));
    localStorage.setItem('userDatabase', JSON.stringify(userDatabase));
    
    // Refresh feed
    displaySocialFeed();
    
    alert(`User "${userToBan.name}" has been banned and all their content removed.`);
  }
}

// === GOOGLE AUTHENTICATION REQUIREMENT ===
function register() {
  const name = document.getElementById('registerName').value;
  const email = document.getElementById('registerEmail').value;
  const password = document.getElementById('registerPassword').value;
  
  if (!name || !email || !password) {
    alert('Please fill in all fields!');
    return;
  }
  
  // Validate Google email
  if (!isValidGoogleEmail(email)) {
    alert('Please use a valid Google account (Gmail address) to register. This helps us maintain a safe community.');
    return;
  }
  
  if (userDatabase[email]) {
    alert('Email already registered! Please login instead.');
    showLogin();
    return;
  }
  
  // Create new user
  const userId = Date.now().toString();
  let avatarUrl = null;
  
  // Handle avatar upload
  if (avatarFile) {
    const reader = new FileReader();
    reader.onload = function(e) {
      avatarUrl = e.target.result;
      completeRegistration(userId, name, email, password, avatarUrl);
    };
    reader.readAsDataURL(avatarFile);
  } else {
    completeRegistration(userId, name, email, password, null);
  }
}

function isValidGoogleEmail(email) {
  // Basic Gmail validation - you can enhance this with more sophisticated checks
  const gmailRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@gmail\.com$/;
  return gmailRegex.test(email.toLowerCase());
}

// === NOTIFICATION SYSTEM ===
function addNotification(type, message, icon = '🔔') {
  const notification = {
    id: 'notification_' + Date.now(),
    type: type,
    message: message,
    icon: icon,
    timestamp: new Date().toISOString(),
    read: false
  };
  
  notifications.unshift(notification);
  unreadNotifications++;
  
  localStorage.setItem('notifications', JSON.stringify(notifications));
  localStorage.setItem('unreadNotifications', unreadNotifications);
  
  updateNotificationBadge();
  showNotificationToast(message, icon);
}

function showNotificationToast(message, icon) {
  const toast = document.createElement('div');
  toast.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(45deg, var(--secondary), var(--accent));
    color: white;
    padding: 15px 20px;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0, 168, 232, 0.4);
    z-index: 1000;
    animation: slideInRight 0.5s ease;
    display: flex;
    align-items: center;
    gap: 10px;
  `;
  toast.innerHTML = `
    <span style="font-size: 20px;">${icon}</span>
    <div>${message}</div>
  `;
  document.body.appendChild(toast);
  
  setTimeout(() => {
    toast.remove();
  }, 4000);
}

function updateNotificationBadge() {
  const socialNavItem = document.querySelector('.nav-item[onclick="showSection(\'social\')"]');
  const existingBadge = socialNavItem.querySelector('.notification-badge');
  
  if (existingBadge) {
    existingBadge.remove();
  }
  
  if (unreadNotifications > 0) {
    const badge = document.createElement('span');
    badge.className = 'notification-badge';
    badge.textContent = unreadNotifications > 99 ? '99+' : unreadNotifications;
    badge.style.cssText = `
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ff4757;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    `;
    socialNavItem.style.position = 'relative';
    socialNavItem.appendChild(badge);
  }
}

function clearSocialNotifications() {
  unreadNotifications = 0;
  localStorage.setItem('unreadNotifications', unreadNotifications);
  updateNotificationBadge();
}

// === RESPONSIVE PROFILE IMAGES ===
function previewAvatar(event) {
  const file = event.target.files[0];
  if (file) {
    avatarFile = file;
    const reader = new FileReader();
    reader.onload = function(e) {
      const avatarPreview = document.getElementById('avatarPreview');
      avatarPreview.innerHTML = `<img src="${e.target.result}" alt="Profile Preview" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
    };
    reader.readAsDataURL(file);
  }
}

function getAvatarUrl(user) {
  if (user.avatarUrl) {
    return user.avatarUrl;
  }
  // Create a colored gradient based on user name
  const colors = ['#FF6B35', '#00A8E8', '#00E676', '#FF4081', '#9C27B0'];
  const colorIndex = user.name.charCodeAt(0) % colors.length;
  return `linear-gradient(45deg, ${colors[colorIndex]}, ${colors[(colorIndex + 1) % colors.length]})`;
}

function updateAvatarDisplay() {
  const userAvatar = document.getElementById('userAvatar');
  const sidebarUserAvatar = document.getElementById('sidebarUserAvatar');
  
  if (currentUser) {
    if (currentUser.avatarUrl) {
      userAvatar.innerHTML = `<img src="${currentUser.avatarUrl}" alt="${currentUser.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
      sidebarUserAvatar.innerHTML = `<img src="${currentUser.avatarUrl}" alt="${currentUser.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
    } else {
      userAvatar.innerHTML = currentUser.avatar;
      sidebarUserAvatar.innerHTML = currentUser.avatar;
      userAvatar.style.background = getAvatarUrl(currentUser);
      sidebarUserAvatar.style.background = getAvatarUrl(currentUser);
    }
  }
}

// === WORKING COLLECTIONS SYSTEM ===
function displayCollections() {
  const collectionsGrid = document.getElementById('collectionsGrid');
  if (!collectionsGrid) return;

  const userCollections = collections[currentUser.id] || {};
  
  if (Object.keys(userCollections).length === 0) {
    collectionsGrid.innerHTML = `
      <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-secondary);">
        <p>No collections yet. Create your first collection to organize your favorite games!</p>
      </div>
    `;
    return;
  }

  collectionsGrid.innerHTML = Object.values(userCollections).map(collection => {
    return `
      <div style="background: var(--surface); padding: 15px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h3>${collection.name}</h3>
        <p>Games: ${collection.games.length}</p>
        <button onclick="viewCollection('${collection.id}')" style="background: var(--secondary); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-right: 10px;">View</button>
        <button onclick="deleteCollection('${collection.id}')" style="background: var(--primary); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Delete</button>
      </div>
    `;
  }).join('');
}

function showCreateCollectionModal() {
  if (!currentUser) {
    showAuthModal();
    return;
  }
  document.getElementById('collectionName').value = '';
  document.getElementById('createCollectionModal').style.display = 'block';
}

function createCollection() {
  const name = document.getElementById('collectionName').value;
  if (!name) {
    alert('Please enter a collection name!');
    return;
  }

  const collectionId = 'collection_' + Date.now();
  if (!collections[currentUser.id]) {
    collections[currentUser.id] = {};
  }
  
  collections[currentUser.id][collectionId] = {
    id: collectionId,
    name: name,
    games: [],
    createdAt: new Date().toISOString()
  };
  
  localStorage.setItem('collections', JSON.stringify(collections));
  closeModal('createCollectionModal');
  displayCollections();
  unlockAchievement('collector', 'Game Collector!', 'You created your first collection!');
}

function viewCollection(collectionId) {
  const collection = collections[currentUser.id][collectionId];
  let gamesHTML = `<h2>${collection.name}</h2>`;
  
  if (collection.games.length === 0) {
    gamesHTML += '<p>No games in this collection yet.</p>';
  } else {
    const collectionGames = allGames.filter(game => collection.games.includes(game.id));
    gamesHTML += '<div class="grid">';
    gamesHTML += collectionGames.map(game => `
      <div class="flip-card" onclick="flipCard(this)">
        <div class="flip-card-inner">
          <div class="flip-card-front">
            <img src="${game.image}" alt="${game.name}" style="width: 100%; height: 140px; object-fit: cover;" onerror="this.src='https://via.placeholder.com/160x140/666/white?text=🎮'">
            <div class="info">
              <h3>${game.name}</h3>
              <p>${game.Platform}</p>
            </div>
          </div>
          <div class="flip-card-back">
            <h3>${game.name}</h3>
            <a class="btn btn-primary" href="${game.link}" target="_blank">🎮 Download</a>
            <button class="btn" onclick="removeFromCollection('${collectionId}', '${game.id}')">❌ Remove</button>
          </div>
        </div>
      </div>
    `).join('');
    gamesHTML += '</div>';
  }
  
  gamesHTML += `<button onclick="showAddToCollectionModal('${collectionId}')" style="background: var(--accent); color: white; border: none; padding: 10px 15px; border-radius: 10px; cursor: pointer; margin-top: 15px;">+ Add Games</button>`;
  gamesHTML += `<button onclick="displayCollections()" style="background: var(--gray); color: white; border: none; padding: 10px 15px; border-radius: 10px; cursor: pointer; margin-top: 15px; margin-left: 10px;">← Back</button>`;
  
  document.getElementById('collectionsGrid').innerHTML = gamesHTML;
}

function showAddToCollectionModal(collectionId) {
  let modalHTML = `
    <div class="modal" id="addToCollectionModal" style="display: block;">
      <div class="modal-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h3>Add Games to Collection</h3>
          <button onclick="closeModal('addToCollectionModal')" style="background: none; border: none; font-size: 24px; cursor: pointer;">×</button>
        </div>
        <div style="max-height: 400px; overflow-y: auto;">
  `;
  
  allGames.forEach(game => {
    const inCollection = collections[currentUser.id][collectionId].games.includes(game.id);
    if (!inCollection) {
      modalHTML += `
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee;">
          <span>${game.name}</span>
          <button onclick="addToCollection('${collectionId}', '${game.id}')" style="background: var(--primary); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Add</button>
        </div>
      `;
    }
  });
  
  modalHTML += `
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', modalHTML);
}

function addToCollection(collectionId, gameId) {
  collections[currentUser.id][collectionId].games.push(gameId);
  localStorage.setItem('collections', JSON.stringify(collections));
  closeModal('addToCollectionModal');
  viewCollection(collectionId);
  unlockAchievement('organizer', 'Game Organizer!', 'You added a game to a collection!');
}

function showAddToCollection(gameId) {
  if (!currentUser) {
    showAuthModal();
    return;
  }
  
  const userCollections = collections[currentUser.id] || {};
  if (Object.keys(userCollections).length === 0) {
    showCreateCollectionModal();
    return;
  }
  
  let collectionList = 'Select a collection:\n\n';
  Object.values(userCollections).forEach((collection, index) => {
    collectionList += `${index + 1}. ${collection.name}\n`;
  });
  
  const choice = prompt(collectionList + '\nEnter collection number:');
  const collectionIndex = parseInt(choice) - 1;
  const collectionKeys = Object.keys(userCollections);
  
  if (collectionIndex >= 0 && collectionIndex < collectionKeys.length) {
    const collectionId = collectionKeys[collectionIndex];
    if (!collections[currentUser.id][collectionId].games.includes(gameId)) {
      collections[currentUser.id][collectionId].games.push(gameId);
      localStorage.setItem('collections', JSON.stringify(collections));
      alert('Game added to collection!');
      unlockAchievement('organizer', 'Game Organizer!', 'You added a game to a collection!');
    } else {
      alert('Game already in this collection!');
    }
  }
}

function removeFromCollection(collectionId, gameId) {
  const collection = collections[currentUser.id][collectionId];
  collection.games = collection.games.filter(id => id !== gameId);
  localStorage.setItem('collections', JSON.stringify(collections));
  viewCollection(collectionId);
}

function deleteCollection(collectionId) {
  if (confirm('Are you sure you want to delete this collection?')) {
    delete collections[currentUser.id][collectionId];
    localStorage.setItem('collections', JSON.stringify(collections));
    displayCollections();
  }
}

// === WORKING ACHIEVEMENTS SYSTEM ===
function showAchievementsSection() {
  if (!currentUser) {
    alert('Please login to view achievements!');
    showAuthModal();
    return;
  }
  
  let achievementsHTML = '<h2>My Achievements</h2>';
  
  const userAchievements = achievements || {};
  const allAchievements = [
    { id: 'welcome', title: 'Welcome to the Hood!', description: 'You joined Gaming Hood!', icon: '👋' },
    { id: 'welcome_back', title: 'Welcome Back!', description: 'You logged in successfully!', icon: '🔁' },
    { id: 'first_rating', title: 'Game Critic!', description: 'You rated your first game!', icon: '⭐' },
    { id: 'lucky', title: 'Feeling Lucky!', description: 'Discover a random game!', icon: '🎯' },
    { id: 'collector', title: 'Game Collector!', description: 'You created your first collection!', icon: '📚' },
    { id: 'organizer', title: 'Game Organizer!', description: 'You added a game to a collection!', icon: '🗂️' },
    { id: 'socializer', title: 'Community Socializer!', description: 'You created your first post!', icon: '💬' },
    { id: 'first_post', title: 'First Post!', description: 'You created your first post!', icon: '📝' },
    { id: 'bookmarker', title: 'Post Bookmarker!', description: 'You saved your first post!', icon: '⭐' },
    { id: 'reaction_master', title: 'Reaction Master!', description: 'You reacted to 10 posts!', icon: '🔥' }
  ];
  
  achievementsHTML += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">';
  
  allAchievements.forEach(achievement => {
    const unlocked = userAchievements[achievement.id];
    achievementsHTML += `
      <div style="background: var(--surface); padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); opacity: ${unlocked ? '1' : '0.5'};">
        <div style="font-size: 40px; margin-bottom: 10px;">${achievement.icon}</div>
        <h3 style="margin-bottom: 10px;">${achievement.title}</h3>
        <p style="color: var(--text-secondary); font-size: 14px;">${achievement.description}</p>
        <div style="margin-top: 10px; color: ${unlocked ? 'var(--accent)' : 'var(--gray)'}; font-weight: bold;">
          ${unlocked ? '✅ UNLOCKED' : '🔒 LOCKED'}
        </div>
      </div>
    `;
  });
  
  achievementsHTML += '</div>';
  
  document.getElementById('achievementsGrid').innerHTML = achievementsHTML;
}

// === FIXED AUTHENTICATION SYSTEM ===
function showAuthModal() {
  closeSidebar();
  document.getElementById('authModal').style.display = 'block';
}

function closeModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
}

function showLogin() {
  document.getElementById('loginForm').style.display = 'block';
  document.getElementById('registerForm').style.display = 'none';
  avatarFile = null;
  document.getElementById('avatarPreview').innerHTML = '<span>+</span>';
}

function showRegister() {
  document.getElementById('loginForm').style.display = 'none';
  document.getElementById('registerForm').style.display = 'block';
}

function login() {
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  
  if (!email || !password) {
    alert('Please enter both email and password!');
    return;
  }
  
  // Check if user exists and password matches
  const user = userDatabase[email];
  if (user && user.password === password) {
    currentUser = {
      id: user.id,
      name: user.name,
      email: user.email,
      avatar: user.avatar,
      avatarUrl: user.avatarUrl,
      joinDate: user.joinDate
    };
    
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    updateUserInterface();
    closeModal('authModal');
    unlockAchievement('welcome_back', 'Welcome Back!', 'You logged in successfully!');
    
    // Clear form
    document.getElementById('loginEmail').value = '';
    document.getElementById('loginPassword').value = '';
  } else {
    alert('Invalid email or password! Please try again or register.');
  }
}

function completeRegistration(userId, name, email, password, avatarUrl) {
  userDatabase[email] = {
    id: userId,
    name: name,
    email: email,
    password: password,
    avatar: name[0].toUpperCase(),
    avatarUrl: avatarUrl,
    joinDate: new Date().toISOString()
  };
  
  localStorage.setItem('userDatabase', JSON.stringify(userDatabase));
  
  currentUser = {
    id: userId,
    name: name,
    email: email,
    avatar: name[0].toUpperCase(),
    avatarUrl: avatarUrl,
    joinDate: new Date().toISOString()
  };
  
  localStorage.setItem('currentUser', JSON.stringify(currentUser));
  updateUserInterface();
  closeModal('authModal');
  unlockAchievement('welcome', 'Welcome to the Hood!', 'You joined Gaming Hood!');
  
  // Clear form
  document.getElementById('registerName').value = '';
  document.getElementById('registerEmail').value = '';
  document.getElementById('registerPassword').value = '';
  avatarFile = null;
  document.getElementById('avatarPreview').innerHTML = '<span>+</span>';
}

function logout() {
  currentUser = null;
  localStorage.removeItem('currentUser');
  updateUserInterface();
  displayGames(allGames); // Refresh to show login prompts
  closeSidebar();
}

function updateUserInterface() {
  if (currentUser) {
    document.getElementById('authButtons').style.display = 'none';
    document.getElementById('userProfile').style.display = 'flex';
    document.getElementById('sidebarUser').classList.add('active');
    document.getElementById('sidebarLoginItem').style.display = 'none';
    
    document.getElementById('sidebarUserName').textContent = currentUser.name;
    document.getElementById('sidebarUserEmail').textContent = currentUser.email;
    
    updateAvatarDisplay();
  } else {
    document.getElementById('authButtons').style.display = 'flex';
    document.getElementById('userProfile').style.display = 'none';
    document.getElementById('sidebarUser').classList.remove('active');
    document.getElementById('sidebarLoginItem').style.display = 'flex';
  }
}

// === SIDEBAR FUNCTIONALITY ===
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('sidebarOverlay');
  sidebar.classList.toggle('active');
  overlay.classList.toggle('active');
}

function closeSidebar() {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('sidebarOverlay');
  sidebar.classList.remove('active');
  overlay.classList.remove('active');
}

document.getElementById('sidebarOverlay').addEventListener('click', closeSidebar);

// === THEME TOGGLE ===
function toggleTheme() {
  document.body.classList.toggle('dark');
  const isDark = document.body.classList.contains('dark');
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
  
  document.getElementById('themeIcon').textContent = isDark ? '🌙' : '🌞';
  document.getElementById('themeText').textContent = isDark ? 'Dark Mode' : 'Light Mode';
}

// Initialize theme
if (localStorage.getItem('theme') === 'dark') {
  document.body.classList.add('dark');
  document.getElementById('themeIcon').textContent = '🌙';
  document.getElementById('themeText').textContent = 'Dark Mode';
}

// === GAME ACTIONS ===
function flipCard(card) {
  if (isLoading) return;
  card.classList.toggle('flipped');
  playSound('flipSound');
}

function toggleFavorite(gameId) {
  if (!currentUser) {
    showAuthModal();
    return;
  }
  
  const index = favorites.indexOf(gameId);
  if (index > -1) {
    favorites.splice(index, 1);
  } else {
    favorites.push(gameId);
    playSound('favoriteSound');
  }
  
  localStorage.setItem('gameFavorites', JSON.stringify(favorites));
  displayGames(allGames);
}

function filterGames(type) {
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.currentTarget.classList.add('active');
  
  let filteredGames = allGames;
  
  switch(type) {
    case 'favorites':
      filteredGames = allGames.filter(game => favorites.includes(game.id));
      break;
    case 'top-rated':
      filteredGames = allGames.filter(game => game.rating >= 4)
                   .sort((a, b) => b.rating - a.rating);
      break;
  }
  
  displayGames(filteredGames);
}

function shuffleGames() {
  const shuffled = [...allGames].sort(() => Math.random() - 0.5);
  displayGames(shuffled);
  playSound('favoriteSound');
}

function feelingLucky() {
  if (allGames.length > 0) {
    const randomGame = [allGames[Math.floor(Math.random() * allGames.length)]];
    displayGames(randomGame);
    playSound('achievementSound');
    unlockAchievement('lucky', 'Feeling Lucky!', 'Discover a random game!');
  }
}

// === FIXED RATING SYSTEM ===
function rateGame(gameId, rating) {
  if (!currentUser) {
    showAuthModal();
    return;
  }
  
  const game = allGames.find(g => g.id === gameId);
  if (!game) return;
  
  // Get previous user rating if exists
  const previousRating = gameRatings[gameId + '_users']?.[currentUser.id] || 0;
  
  // Update user's rating
  if (!gameRatings[gameId + '_users']) {
    gameRatings[gameId + '_users'] = {};
  }
  gameRatings[gameId + '_users'][currentUser.id] = rating;
  
  // Update total and count
  let total = gameRatings[gameId + '_total'] || 0;
  let count = gameRatings[gameId + '_count'] || 0;
  
  // Remove previous rating from total if exists
  if (previousRating > 0) {
    total -= previousRating;
  } else {
    count += 1; // New rating
  }
  
  // Add new rating
  total += rating;
  
  // Update stored values
  gameRatings[gameId + '_total'] = total;
  gameRatings[gameId + '_count'] = count;
  gameRatings[gameId] = count > 0 ? total / count : 0;
  
  // Update game object
  game.rating = gameRatings[gameId];
  game.ratingCount = count;
  
  // Save to localStorage
  localStorage.setItem('gameRatings', JSON.stringify(gameRatings));
  
  // Refresh display
  displayGames(allGames);
  
  // Achievement
  if (count === 1) {
    unlockAchievement('first_rating', 'Game Critic!', 'You rated your first game!');
  }
}

// === ACHIEVEMENT SYSTEM ===
function unlockAchievement(achievementId, title, description) {
  if (!achievements[achievementId]) {
    achievements[achievementId] = true;
    localStorage.setItem('achievements', JSON.stringify(achievements));
    
    const toast = document.createElement('div');
    toast.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(45deg, #FFD700, #FFA000);
      color: #333;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
      z-index: 1000;
      animation: slideInRight 0.5s ease;
    `;
    toast.innerHTML = `
      <strong>🏆 ${title}</strong>
      <div>${description}</div>
    `;
    document.body.appendChild(toast);
    
    playSound('achievementSound');
    
    setTimeout(() => {
      toast.remove();
    }, 4000);
  }
}

// === SOUND SYSTEM ===
function playSound(soundId) {
  try {
    const sound = document.getElementById(soundId);
    sound.currentTime = 0;
    sound.play().catch(e => console.log('Sound play failed:', e));
  } catch (e) {
    console.log('Sound error:', e);
  }
}

// === INITIALIZE APP ===
document.addEventListener('DOMContentLoaded', initializeApp);

// Close modals when clicking outside
window.addEventListener('click', (e) => {
  if (e.target.classList.contains('modal')) {
    e.target.style.display = 'none';
  }
});

// Search functionality
document.getElementById('searchBtn').addEventListener('click', searchGames);
document.getElementById('searchInput').addEventListener('input', searchGames);

function searchGames() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  const filtered = allGames.filter(game => 
    game.name.toLowerCase().includes(query) ||
    game.Platform.toLowerCase().includes(query)
  );
  displayGames(filtered);
}
</script>
</body>
</html>
